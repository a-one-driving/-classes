<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A1 Admin | Premium Control</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --gold: #d4af37;
      --bg: #000;
      --card: #121212;
      --border: #2a2a2a;
      --txt: #fff;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }
    body { background: var(--bg); color: var(--txt); padding: 20px; padding-bottom: 50px; }

    .header { border-bottom: 1px solid var(--gold); padding-bottom: 10px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
    
    .section { background: var(--card); border: 1px solid var(--border); border-radius: 15px; padding: 20px; margin-bottom: 30px; }
    h2 { color: var(--gold); margin-bottom: 20px; font-size: 20px; display: flex; align-items: center; gap: 10px; }

    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }

    input, select { 
      width: 100%; padding: 12px; background: #000; border: 1px solid var(--border); 
      color: #fff; border-radius: 10px; margin-bottom: 10px; outline: none;
    }
    input:focus { border-color: var(--gold); }

    .btn { 
      padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 800; 
      border: none; transition: 0.3s; width: 100%;
    }
    .btn-gold { background: var(--gold); color: #000; }
    .btn-danger { background: #ff4d4d22; color: #ff4d4d; border: 1px solid #ff4d4d; }
    .btn-gold:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(212,175,55,0.3); }

    table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border); }
    th { color: var(--gold); }

    .batch-preview { 
        background: #000; border: 1px solid var(--border); padding: 15px; 
        border-radius: 12px; margin-top: 10px;
    }
  </style>
</head>
<body>

<div class="header">
    <h1>A1 <span style="font-weight:300; color:var(--gold);">ADMIN</span></h1>
    <div id="liveClock" style="color:var(--gold); font-weight:800;"></div>
</div>

<section class="section">
    <h2>‚öôÔ∏è Website Status</h2>
    <div class="grid">
        <select id="isOff">
            <option value="false">‚úÖ Website Active</option>
            <option value="true">‚ö†Ô∏è Class Cancelled</option>
        </select>
        <input type="text" id="offReason" placeholder="Reason (e.g. Heavy Rain)">
        <button class="btn btn-gold" onclick="updateStatus()">Update Status</button>
    </div>
</section>

<section class="section">
    <h2>üë®‚Äçüéì Student Class Counter</h2>
    <div class="grid">
        <input type="text" id="stuName" placeholder="Student Name">
        <input type="tel" id="stuPhone" placeholder="Phone (ID)">
        <input type="number" id="stuRemaining" placeholder="Classes Left">
        <button class="btn btn-gold" onclick="saveStudent()">Add/Update Student</button>
    </div>
    <div style="overflow-x:auto;">
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Remaining</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="studentTable"></tbody>
        </table>
    </div>
</section>

<section class="section">
    <h2>üéüÔ∏è Manage Batches & Daily Plan</h2>
    <p style="font-size: 12px; color: var(--gold); margin-bottom: 10px;">Yahan se aap Route aur Skill update kar sakte hain jo bacchon ko dikhega.</p>
    <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));">
        <input type="text" id="slotName" placeholder="Batch Name">
        <input type="text" id="slotTime" placeholder="Time (e.g. 6-7 AM)">
        <input type="text" id="slotRoute" placeholder="Today's Route">
        <input type="text" id="slotSkill" placeholder="Today's Skill">
        <button class="btn btn-gold" onclick="addSlot()">Save Batch Plan</button>
    </div>
    <div id="batchList" class="grid" style="margin-top:20px;"></div>
</section>

<section class="section">
    <h2>üöó Current Bookings</h2>
    <div style="overflow-x:auto;">
        <table>
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Phone</th>
                    <th>Batch</th>
                    <th>Seat</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="bookingTable"></tbody>
        </table>
    </div>
</section>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getFirestore, collection, doc, setDoc, deleteDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC3gWi8p85z-wkoJeWbN3jYoQpcIar8Sww",
    authDomain: "abinash-driving.firebaseapp.com",
    projectId: "abinash-driving",
    storageBucket: "abinash-driving.appspot.com",
    messagingSenderId: "641148830173",
    appId: "1:641148830173:web:b7a500e5e7e2463da0f634"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // 1. Status Control
  window.updateStatus = async () => {
    const isOff = document.getElementById("isOff").value === "true";
    const reason = document.getElementById("offReason").value;
    await setDoc(doc(db, "siteControl", "classStatus"), { isOff, reason });
    alert("Status Updated!");
  };

  // 2. Student Manager
  window.saveStudent = async () => {
    const name = document.getElementById("stuName").value;
    const phone = document.getElementById("stuPhone").value;
    const remaining = document.getElementById("stuRemaining").value;
    if(!name || !phone || !remaining) return alert("Fill All Fields");
    await setDoc(doc(db, "studentData", phone), { name, phone, remaining: parseInt(remaining) });
    alert("Student Data Updated!");
    ["stuName","stuPhone","stuRemaining"].forEach(id => document.getElementById(id).value = "");
  };

  onSnapshot(collection(db, "studentData"), (snap) => {
    const tbody = document.getElementById("studentTable");
    tbody.innerHTML = "";
    snap.forEach(d => {
        const s = d.data();
        tbody.innerHTML += `<tr>
            <td>${s.name}</td>
            <td>${s.phone}</td>
            <td style="color:var(--gold); font-weight:800;">${s.remaining}</td>
            <td>
                <button onclick="editStu('${s.name}','${s.phone}',${s.remaining})" style="color:var(--gold); background:none; border:none; cursor:pointer;">Edit</button> | 
                <button onclick="delStu('${s.phone}')" style="color:red; background:none; border:none; cursor:pointer;">Del</button>
            </td>
        </tr>`;
    });
  });

  window.delStu = async (id) => { if(confirm("Delete Student?")) await deleteDoc(doc(db, "studentData", id)); };
  window.editStu = (n,p,r) => { 
      document.getElementById("stuName").value = n; 
      document.getElementById("stuPhone").value = p; 
      document.getElementById("stuRemaining").value = r; 
  };

  // 3. Batch Manager with Route & Skill
  window.addSlot = async () => {
    const name = document.getElementById("slotName").value;
    const time = document.getElementById("slotTime").value;
    const route = document.getElementById("slotRoute").value;
    const skill = document.getElementById("slotSkill").value;
    if(!name || !time) return alert("Name & Time mandatory!");
    
    await setDoc(doc(db, "siteSlots", name), { 
        name, time, 
        route: route || "Local Road", 
        skill: skill || "General Practice" 
    });
    alert("Batch Plan Updated!");
    ["slotName","slotTime","slotRoute","slotSkill"].forEach(id => document.getElementById(id).value = "");
  };

  onSnapshot(collection(db, "siteSlots"), (snap) => {
    const list = document.getElementById("batchList");
    list.innerHTML = "";
    snap.forEach(d => {
        const s = d.data();
        list.innerHTML += `
        <div class="batch-preview">
            <b style="color:var(--gold);">${s.name}</b> <small>(${s.time})</small>
            <div style="font-size:11px; color:#aaa; margin:5px 0;">üìç ${s.route} | üéØ ${s.skill}</div>
            <div style="display:flex; gap:5px;">
                <button onclick="editBatch('${s.name}','${s.time}','${s.route}','${s.skill}')" style="font-size:10px; background:none; border:1px solid #555; color:#fff; cursor:pointer; padding:2px 5px; border-radius:4px;">Edit Plan</button>
                <button onclick="delSlot('${d.id}')" style="font-size:10px; background:none; border:1px solid #ff4d4d; color:#ff4d4d; cursor:pointer; padding:2px 5px; border-radius:4px;">Delete</button>
            </div>
        </div>`;
    });
  });
  window.delSlot = async (id) => { if(confirm("Delete Batch?")) await deleteDoc(doc(db, "siteSlots", id)); };
  window.editBatch = (n,t,r,s) => {
      document.getElementById("slotName").value = n;
      document.getElementById("slotTime").value = t;
      document.getElementById("slotRoute").value = r;
      document.getElementById("slotSkill").value = s;
  };

  // 4. Booking Logic
  onSnapshot(collection(db, "slotBookings"), (snap) => {
    const tbody = document.getElementById("bookingTable");
    tbody.innerHTML = "";
    snap.forEach(d => {
        const b = d.data();
        tbody.innerHTML += `<tr>
            <td>${b.name}</td>
            <td>${b.phone}</td>
            <td>${b.slotId}</td>
            <td>A${b.seat}</td>
            <td><button class="btn-danger" onclick="clearB('${d.id}')" style="padding:2px 10px; width:auto;">Clear</button></td>
        </tr>`;
    });
  });
  window.clearB = async (id) => { if(confirm("Clear this seat?")) await deleteDoc(doc(db, "slotBookings", id)); };

  setInterval(() => { document.getElementById("liveClock").innerText = new Date().toLocaleTimeString(); }, 1000);
</script>
</body>
</html>
