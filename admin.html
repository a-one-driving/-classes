<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel ‚Äì Abhinaash A One Driving Classes</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Poppins,sans-serif}
body{background:#0b1020;color:white;padding:20px}
h2,h3{margin-bottom:10px}

.loginBox{
max-width:420px;margin:80px auto;background:#111;
padding:25px;border-radius:16px;text-align:center;
}

input,select{
width:100%;padding:12px;margin:8px 0;
border-radius:10px;border:none;font-size:14px;
}

button{
padding:12px;border:none;border-radius:10px;
font-weight:800;cursor:pointer;
}

.btnMain{background:#00d4ff;color:#041018;width:100%}
.btnDanger{background:#ff4d4d;color:white}
.btnSmall{padding:6px 10px;font-size:12px;margin-top:6px}

.panel{display:none;max-width:1200px;margin:auto}

.section{
background:#111;padding:20px;border-radius:16px;
margin-bottom:25px;
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:14px;
}

.card{
background:#1a1a1a;padding:14px;border-radius:12px;
border:1px solid rgba(255,255,255,.1);
}

.badgePaid{color:#00ff88;font-weight:800}
.badgePending{color:#ffcc00;font-weight:800}

.search{margin-bottom:12px}

.stat{
background:#1a1a1a;border-radius:14px;
padding:14px;text-align:center;
}
.stat h3{font-size:22px}
.stat p{color:rgba(255,255,255,.7);font-size:13px}



.newBadge{
background:#00ff88;
color:#041018;
font-size:11px;
padding:4px 8px;
border-radius:8px;
font-weight:900;
margin-left:6px;
animation:newBlink 1s infinite;
}

@keyframes newBlink{
0%{opacity:1; transform:scale(1)}
50%{opacity:.4; transform:scale(1.1)}
100%{opacity:1; transform:scale(1)}
}

.newCard{
box-shadow:0 0 20px rgba(0,255,136,.6);
border:1px solid #00ff88 !important;
animation:newGlow 1.5s infinite alternate;
}

@keyframes newGlow{
from{box-shadow:0 0 10px rgba(0,255,136,.4)}
to{box-shadow:0 0 25px rgba(0,255,136,.9)}
}

</style>
</head>

<body>

<!-- LOGIN -->
<div class="loginBox" id="loginBox">
<h2>üîê Admin Login</h2>
<input type="password" id="adminPass" placeholder="Enter password">
<button class="btnMain" onclick="login()">Login</button>
</div>

<!-- PANEL -->
<div class="panel" id="panel">

<h2>üëë Abhinaash Driving ‚Äì Admin Dashboard</h2>

<!-- DASHBOARD -->
<div class="section">
<h3>üìä Group Students Monthly Dashboard</h3>

<div class="grid">
<div class="stat">
<h3 id="thisMonth">0</h3>
<p>This Month Group Students</p>
</div>
<div class="stat">
<h3 id="lastMonth">0</h3>
<p>Last Month Group Students</p>
</div>
<div class="stat">
<h3 id="growth">0%</h3>
<p>Growth</p>
</div>
<div class="stat">
<h3 id="totalGroup">0</h3>
<p>Total Group Students</p>
</div>
</div>

<div class="grid" style="margin-top:14px">
<div class="stat">
<h3 id="monthEarning">‚Çπ0</h3>
<p>This Month Group Earning</p>
</div>
<div class="stat">
<h3 id="totalEarning">‚Çπ0</h3>
<p>Total Group Earning</p>
</div>
</div>
</div>

<!-- CHART -->
<div class="section">
<h3>üìà Monthly Group Joining Chart</h3>
<canvas id="chart" height="120"></canvas>
</div>

<!-- STUDENT DATABASE -->
<div class="section">
<h3>üë®‚Äçüéì Student Database</h3>

<div class="grid">
<input id="sName" placeholder="Student Name">
<input id="sPhone" placeholder="Phone Number">
<select id="sClass">
<option value="">Class Type</option>
<option value="Group">Group</option>
<option value="Personal">Personal</option>
</select>
<select id="sFee">
<option value="">Fee Status</option>
<option value="Paid">Paid</option>
<option value="Pending">Pending</option>
</select>
</div>

<button class="btnMain" style="margin-top:10px" onclick="addStudent()">‚ûï Add Student</button>
</div>

<div class="section">
<input class="search" id="searchBox" placeholder="üîç Search by name or phone" oninput="renderStudents()">
<div id="studentList"></div>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyC3gWi8p85z-wkoJeWbN3jYoQpcIar8Sww",
authDomain: "abinash-driving.firebaseapp.com",
projectId: "abinash-driving",
storageBucket: "abinash-driving.firebasestorage.app",
messagingSenderId: "641148830173",
appId: "1:641148830173:web:b7a500e5e7e2463da0f634"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const studentsCol = collection(db,"students");

let STUDENTS=[];
let chart; 

window.login=function(){
if(document.getElementById("adminPass").value==="Admin5"){
loginBox.style.display="none";
panel.style.display="block";
loadStudents();
}else alert("Wrong password");
}

window.addStudent=async function(){
if(!sName.value||!sPhone.value||!sClass.value||!sFee.value){
alert("Fill all fields");return;
}
await addDoc(studentsCol,{
name:sName.value,
phone:sPhone.value,
classType:sClass.value,
feeStatus:sFee.value,
joinedAt:serverTimestamp()
});
sName.value=sPhone.value="";
sClass.value=sFee.value="";
}

function loadStudents(){
onSnapshot(studentsCol,(snap)=>{
STUDENTS=[];
snap.forEach(d=>STUDENTS.push({id:d.id,...d.data()}));
renderStudents();
updateDashboard();
});
}

window.renderStudents=function(){
const q=searchBox.value.toLowerCase();
let html="";

STUDENTS.filter(s=>
s.name.toLowerCase().includes(q)||s.phone.includes(q)
).forEach(s=>{

let isNew=false;

if(s.joinedAt){
const joinDate=s.joinedAt.toDate();
const now=new Date();
const diff=(now-joinDate)/(1000*60*60); // hours
if(diff<24) isNew=true;
}

html+=`
<div class="card ${isNew?"newCard":""}">
<b>${s.name}</b> ${isNew?'<span class="newBadge">NEW</span>':""}<br>
üìû ${s.phone}<br>
üéì ${s.classType}<br>
üí∞ <span class="${s.feeStatus==="Paid"?"badgePaid":"badgePending"}">${s.feeStatus}</span><br>
<button class="btnSmall btnDanger" onclick="deleteStudent('${s.id}')">Delete</button>
</div>
`;
});

studentList.innerHTML=html||"No students found";
}

window.deleteStudent=async function(id){
if(confirm("Delete student?")){
await deleteDoc(doc(db,"students",id));
}
}

function updateDashboard(){
const now=new Date();
const m=now.getMonth(), y=now.getFullYear();
const lastM=m===0?11:m-1;
const lastY=m===0?y-1:y;

let thisMonth=0,lastMonth=0,totalGroup=0;
let monthlyCounts=Array(12).fill(0);

STUDENTS.forEach(s=>{
if(s.classType!=="Group"||!s.joinedAt)return;
const d=s.joinedAt.toDate();
totalGroup++;
monthlyCounts[d.getMonth()]++;
if(d.getMonth()===m && d.getFullYear()===y) thisMonth++;
if(d.getMonth()===lastM && d.getFullYear()===lastY) lastMonth++;
});

thisMonthEl.innerText=thisMonth;
lastMonthEl.innerText=lastMonth;
growthEl.innerText=lastMonth?(((thisMonth-lastMonth)/lastMonth)*100).toFixed(1)+"%":"100%";
totalGroupEl.innerText=totalGroup;
monthEarning.innerText="‚Çπ"+(thisMonth*4500);
totalEarning.innerText="‚Çπ"+(totalGroup*4500);

drawChart(monthlyCounts);
}

function drawChart(data){
const ctx=document.getElementById("chart");
if(chart) chart.destroy();
chart=new Chart(ctx,{
type:"bar",
data:{
labels:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],
datasets:[{
label:"Group Students",
data,
backgroundColor:"#00d4ff"
}]
},
options:{plugins:{legend:{display:false}}}
});
}
</script>

</body>
</html>