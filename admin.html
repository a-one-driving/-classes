<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A1 Admin | Premium Control</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --gold: #d4af37;
      --bg: #000;
      --card: #121212;
      --border: #2a2a2a;
      --txt: #fff;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }
    body { background: var(--bg); color: var(--txt); padding: 20px; }

    .header { border-bottom: 1px solid var(--gold); padding-bottom: 10px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
    
    .section { background: var(--card); border: 1px solid var(--border); border-radius: 15px; padding: 20px; margin-bottom: 30px; }
    h2 { color: var(--gold); margin-bottom: 20px; font-size: 20px; display: flex; align-items: center; gap: 10px; }

    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }

    /* Inputs & Buttons */
    input, select { 
      width: 100%; padding: 12px; background: #000; border: 1px solid var(--border); 
      color: #fff; border-radius: 10px; margin-bottom: 10px; outline: none;
    }
    input:focus { border-color: var(--gold); }

    .btn { 
      padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 800; 
      border: none; transition: 0.3s; width: 100%;
    }
    .btn-gold { background: var(--gold); color: #000; }
    .btn-danger { background: #ff4d4d; color: #fff; }
    .btn-gold:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(212,175,55,0.3); }

    /* Table Styles */
    table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border); }
    th { color: var(--gold); }

    .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 800; }
    .on { background: #00ff8822; color: #00ff88; border: 1px solid #00ff88; }
    .off { background: #ff4d4d22; color: #ff4d4d; border: 1px solid #ff4d4d; }
  </style>
</head>
<body>

<div class="header">
    <h1>A1 <span style="font-weight:300; color:var(--gold);">ADMIN</span></h1>
    <div id="liveClock" style="color:var(--gold); font-weight:800;"></div>
</div>

<section class="section">
    <h2>‚öôÔ∏è Website Status Control</h2>
    <div class="grid">
        <div>
            <label>Class Status</label>
            <select id="isOff">
                <option value="false">Active (Normal)</option>
                <option value="true">Closed (Emergency)</option>
            </select>
        </div>
        <div>
            <label>Reason (If Closed)</label>
            <input type="text" id="offReason" placeholder="e.g. Due to Heavy Rain">
        </div>
        <button class="btn btn-gold" onclick="updateStatus()">Update Website Status</button>
    </div>
</section>

<section class="section">
    <h2>üë®‚Äçüéì Student Class Manager (Checker)</h2>
    <div class="grid">
        <input type="text" id="stuName" placeholder="Student Name">
        <input type="tel" id="stuPhone" placeholder="Phone Number (ID)">
        <input type="number" id="stuRemaining" placeholder="Classes Left">
        <button class="btn btn-gold" onclick="saveStudent()">Add/Update Student</button>
    </div>
    <div style="overflow-x:auto;">
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Remaining</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="studentTable"></tbody>
        </table>
    </div>
</section>

<section class="section">
    <h2>üéüÔ∏è Manage Batches</h2>
    <div class="grid">
        <input type="text" id="slotName" placeholder="Batch Name (e.g. Morning 1)">
        <input type="text" id="slotTime" placeholder="Time (e.g. 7AM - 8AM)">
        <button class="btn btn-gold" onclick="addSlot()">Add New Batch</button>
    </div>
    <div id="batchList" class="grid" style="margin-top:20px;"></div>
</section>

<section class="section">
    <h2>üöó Recent Bookings (Real-time)</h2>
    <div style="overflow-x:auto;">
        <table>
            <thead>
                <tr>
                    <th>Student Name</th>
                    <th>Phone</th>
                    <th>Batch</th>
                    <th>Seat</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="bookingTable"></tbody>
        </table>
    </div>
</section>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getFirestore, collection, doc, setDoc, deleteDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC3gWi8p85z-wkoJeWbN3jYoQpcIar8Sww",
    authDomain: "abinash-driving.firebaseapp.com",
    projectId: "abinash-driving",
    storageBucket: "abinash-driving.appspot.com",
    messagingSenderId: "641148830173",
    appId: "1:641148830173:web:b7a500e5e7e2463da0f634"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // --- 1. WEBSITE STATUS LOGIC ---
  window.updateStatus = async () => {
    const isOff = document.getElementById("isOff").value === "true";
    const reason = document.getElementById("offReason").value;
    await setDoc(doc(db, "siteControl", "classStatus"), { isOff, reason });
    alert("Website status updated!");
  };

  // --- 2. STUDENT CLASS MANAGER LOGIC ---
  window.saveStudent = async () => {
    const name = document.getElementById("stuName").value;
    const phone = document.getElementById("stuPhone").value;
    const remaining = document.getElementById("stuRemaining").value;
    if(!name || !phone || !remaining) return alert("Fill all fields");
    
    await setDoc(doc(db, "studentData", phone), { name, phone, remaining: parseInt(remaining) });
    alert("Student Data Saved!");
    document.getElementById("stuName").value = ""; document.getElementById("stuPhone").value = ""; document.getElementById("stuRemaining").value = "";
  };

  onSnapshot(collection(db, "studentData"), (snap) => {
    const tbody = document.getElementById("studentTable");
    tbody.innerHTML = "";
    snap.forEach(d => {
        const s = d.data();
        tbody.innerHTML += `<tr>
            <td>${s.name}</td>
            <td>${s.phone}</td>
            <td style="color:var(--gold); font-weight:800;">${s.remaining} Classes</td>
            <td>
                <button onclick="editStu('${s.name}','${s.phone}',${s.remaining})" style="color:var(--gold); background:none; border:none; cursor:pointer;">Edit</button> | 
                <button onclick="delStu('${s.phone}')" style="color:red; background:none; border:none; cursor:pointer;">Del</button>
            </td>
        </tr>`;
    });
  });
  window.delStu = async (id) => { if(confirm("Delete student?")) await deleteDoc(doc(db, "studentData", id)); };
  window.editStu = (n,p,r) => { 
      document.getElementById("stuName").value = n; 
      document.getElementById("stuPhone").value = p; 
      document.getElementById("stuRemaining").value = r; 
  };

  // --- 3. BATCH MANAGER LOGIC ---
  window.addSlot = async () => {
    const name = document.getElementById("slotName").value;
    const time = document.getElementById("slotTime").value;
    if(!name || !time) return;
    await setDoc(doc(db, "siteSlots", name), { name, time });
    alert("Batch Added!");
  };

  onSnapshot(collection(db, "siteSlots"), (snap) => {
    const list = document.getElementById("batchList");
    list.innerHTML = "";
    snap.forEach(d => {
        const s = d.data();
        list.innerHTML += `<div class="section" style="margin:0;">
            <b style="color:var(--gold)">${s.name}</b><br><small>${s.time}</small>
            <button onclick="delSlot('${s.id || s.name}')" class="btn btn-danger" style="padding:5px; margin-top:10px; font-size:10px;">Delete Batch</button>
        </div>`;
    });
  });
  window.delSlot = async (id) => { if(confirm("Delete batch?")) await deleteDoc(doc(db, "siteSlots", id)); };

  // --- 4. LIVE BOOKINGS LOGIC ---
  onSnapshot(collection(db, "slotBookings"), (snap) => {
    const tbody = document.getElementById("bookingTable");
    tbody.innerHTML = "";
    snap.forEach(d => {
        const b = d.data();
        tbody.innerHTML += `<tr>
            <td>${b.name || 'N/A'}</td>
            <td>${b.phone || 'N/A'}</td>
            <td>${b.slotId}</td>
            <td>Seat A${b.seat}</td>
            <td><button onclick="clearBooking('${d.id}')" style="color:red; cursor:pointer;">Clear</button></td>
        </tr>`;
    });
  });
  window.clearBooking = async (id) => { if(confirm("Free this seat?")) await deleteDoc(doc(db, "slotBookings", id)); };

  // Clock
  setInterval(() => { document.getElementById("liveClock").innerText = new Date().toLocaleTimeString(); }, 1000);
</script>
</body>
</html>
