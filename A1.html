<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A1 Admin | Control Center</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root { --gold: #d4af37; --bg: #0b0b0b; --card: #1a1a1a; --txt: #ffffff; }
    body { background: var(--bg); color: var(--txt); font-family: 'Poppins', sans-serif; padding: 20px; }
    .section { background: var(--card); padding: 20px; border-radius: 15px; border: 1px solid var(--gold); margin-bottom: 25px; }
    h2 { color: var(--gold); font-size: 18px; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 5px; }
    input, select, button { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #333; background: #000; color: #fff; outline: none; }
    button { background: var(--gold); color: #000; font-weight: 800; border: none; cursor: pointer; }
    .btn-del { background: #ff4d4d; color: #fff; padding: 5px 10px; width: auto; font-size: 10px; }
    .list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #333; }
  </style>
</head>
<body>

<h1>ğŸ‘‘ A1 Control Center</h1>
<p style="font-size: 12px; color: var(--gold); margin-bottom: 20px;">Abhinaash A1 Driving Academy</p>

<div class="section">
  <h2>ğŸ“¢ Update Announcement Bar</h2>
  <input type="text" id="notifText" placeholder="Message (e.g. New Batches Starting Monday!)">
  <select id="notifStatus">
    <option value="true">Show Bar</option>
    <option value="false">Hide Bar</option>
  </select>
  <button onclick="updateNotif()">Update Bar</button>
</div>

<div class="section">
  <h2>ğŸŸï¸ Add New Batch</h2>
  <input type="text" id="bId" placeholder="Batch ID (e.g. MORNING_7AM)">
  <input type="text" id="bName" placeholder="Batch Name (e.g. Early Bird)">
  <input type="text" id="bTime" placeholder="Time (e.g. 7:00 AM - 8:00 AM)">
  <select id="bStatus">
    <option value="old">Regular Batch</option>
    <option value="new">Mark as NEW BATCH</option>
  </select>
  <button onclick="addBatch()">Create Batch</button>
  
  <div id="batchList" style="margin-top: 20px;">
    <h3>Current Batches:</h3>
    </div>
</div>

<div class="section">
  <h2>ğŸ“Š Update Student Classes</h2>
  <input type="tel" id="sPhone" placeholder="Student Mobile Number">
  <input type="text" id="sName" placeholder="Student Name">
  <input type="number" id="sRem" placeholder="Remaining Classes (e.g. 12)">
  <button onclick="updateStudent()">Save Student Data</button>
</div>

<div class="section">
  <h2 style="color: #ff4d4d;">âš ï¸ Reset Bookings</h2>
  <p style="font-size: 10px; color: #888;">Naye hafte ke liye purani seats khali karein.</p>
  <button style="background: #333; color: #fff;" onclick="clearAllBookings()">Clear All Seats</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getFirestore, doc, setDoc, deleteDoc, collection, onSnapshot, getDocs } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC3gWi8p85z-wkoJeWbN3jYoQpcIar8Sww",
    authDomain: "abinash-driving.firebaseapp.com",
    projectId: "abinash-driving",
    storageBucket: "abinash-driving.appspot.com",
    messagingSenderId: "641148830173",
    appId: "1:641148830173:web:b7a500e5e7e2463da0f634"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // 1. NOTIFICATION UPDATE
  window.updateNotif = async () => {
    const txt = document.getElementById("notifText").value;
    const stat = document.getElementById("notifStatus").value === "true";
    await setDoc(doc(db, "siteSettings", "announcement"), { text: txt, active: stat });
    alert("Announcement Updated!");
  };

  // 2. BATCH MANAGEMENT
  window.addBatch = async () => {
    const id = document.getElementById("bId").value;
    const name = document.getElementById("bName").value;
    const time = document.getElementById("bTime").value;
    const status = document.getElementById("bStatus").value;
    if(!id || !name) return alert("Fill ID and Name!");
    await setDoc(doc(db, "siteSlots", id), { name, time, status });
    alert("Batch Added!");
  };

  onSnapshot(collection(db, "siteSlots"), (snap) => {
    const list = document.getElementById("batchList");
    list.innerHTML = "<h3>Current Batches:</h3>";
    snap.forEach(d => {
      list.innerHTML += `
        <div class="list-item">
          <span>${d.id} (${d.data().status})</span>
          <button class="btn-del" onclick="deleteBatch('${d.id}')">Delete</button>
        </div>`;
    });
  });

  window.deleteBatch = async (id) => {
    if(confirm("Delete this batch?")) await deleteDoc(doc(db, "siteSlots", id));
  };

  // 3. STUDENT DATA
  window.updateStudent = async () => {
    const p = document.getElementById("sPhone").value;
    const n = document.getElementById("sName").value;
    const r = document.getElementById("sRem").value;
    if(!p || !n) return alert("Need Phone and Name!");
    await setDoc(doc(db, "studentData", p), { name: n, remaining: r });
    alert("Student Data Saved!");
  };

  // 4. CLEAR BOOKINGS
  window.clearAllBookings = async () => {
    if(confirm("Are you sure? This will empty all booked seats!")) {
      const snap = await getDocs(collection(db, "slotBookings"));
      snap.forEach(async (d) => {
        await deleteDoc(doc(db, "slotBookings", d.id));
      });
      alert("All seats are now available!");
    }
  };
</script>
</body>
</html>
